<!DOCTYPE html>
<html lang="en" style="overflow:hidden">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="white">
    <meta name="format-detection" content="telephone=no">
    <link href="/css/yujia/globalAll.css" rel="stylesheet" type="text/css"/>
    <link href="/css/yujia/layout.css" rel="stylesheet" type="text/css" />
    <link href="/assets/weiui/weui.css" rel="stylesheet" type="text/css" />
    <link href="/css/yujia/master.css?20171212" rel="stylesheet" type="text/css" />

    <style type="text/css">
        body { background-color: #f0f3f5 !important; }
        .btn-group { width: 100% !important }
        .dropdown-menu { height: 134px !important }
    </style>
    <title>日新洗衣</title>
</head>
<body>
<div id="html_Layout">
    <div id="html_body">
        <div class="head containered" style="position:fixed;width:100%;z-index:500;top:0;clear: both;">
            <a class="one l GoBack" href="javascript:history.back(-1);" style="">
                <span class="icon_back"></span>
            </a>
            <div class="two l fc">
                <p class="Sub fc text-ellipsis">洗衣</p>
            </div>
            <div class="third l fr naved">
                <div class="nav_out"></div> </div>
        </div>
        <form id="form1">
            <input type="hidden" name="Method" value="0" />
            <input type="hidden" name="Master" value="0" />
            <input type="hidden" name="CollageKey" value="" />
            <input type="text" id="ServiceNos" name="ServiceNos" value="" />
            <input type="hidden" id="ProductId" name="ProductId" value="139" />
            <input type="hidden" id="ProductCode" name="ProductCode" value="0009" />
            <input type="hidden" id="ProductName" value="洗衣" />
            <input type="hidden" id="CityId" name="CityId" value="1" />
            <input type="hidden" id="ArearId" name="ArearId" value="3" />
            <input id="StartTime" name="StartTime" type="hidden" value="" />
            <input id="StartTimeSpan" name="StartTimeSpan" type="hidden" value="" />
            <input id="EndTimeSpan" name="EndTimeSpan" type="hidden" value="" />
            <div class="xdmain" id="main" style="margin-bottom: 0.98rem;">
                <div class="xd-cp">
                    <img class="xd-cpicon l" src="/imgs/xiadan.jpg" />
                    <div class="xd-cpinfo l">
                        <p class="color_222 fslh_r032">日新洗衣</p>
                        <p class="color_777 fslh_r026 mtop_r020">洗衣洗衣洗衣洗衣洗衣洗衣洗衣！</p>
                        #*<p class="colord91010 fslh_r032 mtop_r030">￥8</p>*#
                    </div>
                    <div class="clear"></div>
                </div>
                <input type="hidden" id="Addrs0" name="Addrs[0]" value="1262351" />
                <div class="xd-box pleft036 ptop036 mtop_r024 xd-box-bord">
                    <div class="xd-box-hd pbottom010">
                        <div class="xd-hd-title">
                            <i class="xd-icon xdi-dz"></i>
                            <span class="xd-title">服务地址</span>
                        </div>
                        <div class="clear"></div>
                    </div>
                    <div class="xd-inps inps-bord">
                        <div class="xd-inpbox">
                            <input type="text" class="xd-inp inp-arr serviceAddr" id="serviceAddr0" data-idaddr="Addrs0" placeholder="请选择服务地址" value="宿迁市恒大华府3#1207" readonly="readonly" onfocus="this.blur();" /><i class="xd-arr"></i>
                        </div>
                    </div>
                </div>
                <div class="xd-box pleft036 ptop036 pbottom024">
                    <div class="xd-box-hd pbottom010">
                        <div class="xd-hd-title">
                            <i class="xd-icon xdi-sj"></i>
                            <span class="xd-title">服务时间</span>
                        </div>
                        <div class="clear"></div>
                    </div>
                    <div class="xd-inps inps-bord">
                        <div class="xd-inpbox"><input id="DateTimeFixed" type="text" class="xd-inp inp-arr" placeholder="请选择服务时间" readonly="readonly" onfocus="this.blur();" value="立即"/><i class="xd-arr xd-arr-bottom"></i></div>
                    </div>
                </div>
                <div id="serviceProject" class="xd-box pleft036 mtop_r012">
                    <div class="xd-box-hd ptop036 pbottom036">
                        <div class="xd-hd-title">
                            <i class="xd-icon xdi-xm"></i>
                            <span class="xd-title">服务项目</span>
                        </div>
                        <div class="clear"></div>
                    </div>
                    <div class="xd-xms pbottom012 skuList" data-min="30" data-max="200">
                        #*<div class="xd-xm pbottom024 skuAndUnit">
                            <input type="hidden" class="gwcPrice" value="0" />
                            <input type="hidden" id="SkuDes_0_SKus_0_Id" name="SkuDes[0].SKus[0].Id" class="skuId" value="143" />
                            <input type="hidden" id="SkuDes_0_SKus_0_Name" name="SkuDes[0].SKus[0].Name" class="skuValue" value="一般污渍" />
                            <input type="hidden" id="SkuDes_0_Units_0_Id" name="SkuDes[0].Units[0].Id" class="unitId" value="260" />
                            <input type="hidden" id="SkuDes_0_Units_0_Name" name="SkuDes[0].Units[0].Name" class="unitName" value="平方数" />
                            <div class="xd-xm-title l">单衬衫</div>
                            <div class="xd-numbox l">
                                <div class="xd-jian">-</div>
                                <input class="xd-num skuNum unitNumber" id="SkuDes_0_Units_0_Name" name="SkuDes[0].Units[0].Number" value="0" />
                                <div class="xd-jia">＋</div>
                                <div class="xd-unit">件</div>
                                <div class="clear"></div>
                            </div>
                            <div class="xd-xm-price r mright_r024 skuPrice">
                                预估 ¥0
                            </div>
                            <div class="clear"></div>
                        </div>
                        <div class="xd-xm pbottom024 skuAndUnit">
                            <input type="hidden" class="gwcPrice" value="0" />
                            <input type="hidden" id="SkuDes_1_SKus_0_Id" name="SkuDes[1].SKus[0].Id" class="skuId" value="143" />
                            <input type="hidden" id="SkuDes_1_SKus_0_Name" name="SkuDes[1].SKus[0].Name" class="skuValue" value="中度污渍" />
                            <input type="hidden" id="SkuDes_1_Units_0_Id" name="SkuDes[1].Units[0].Id" class="unitId" value="260" />
                            <input type="hidden" id="SkuDes_1_Units_0_Name" name="SkuDes[1].Units[0].Name" class="unitName" value="平方数" />
                            <div class="xd-xm-title l">西服上衣</div>
                            <div class="xd-numbox l">
                                <div class="xd-jian">-</div>
                                <input class="xd-num skuNum unitNumber" id="SkuDes_1_Units_0_Name" name="SkuDes[1].Units[0].Number" value="0" />
                                <div class="xd-jia">＋</div>
                                <div class="xd-unit">件</div>
                                <div class="clear"></div>
                            </div>
                            <div class="xd-xm-price r mright_r024 skuPrice">
                                预估 ¥0
                            </div>
                            <div class="clear"></div>
                        </div>
                        <div class="xd-xm pbottom024 skuAndUnit">
                            <input type="hidden" class="gwcPrice" value="0" />
                            <input type="hidden" id="SkuDes_2_SKus_0_Id" name="SkuDes[2].SKus[0].Id" class="skuId" value="143" />
                            <input type="hidden" id="SkuDes_2_SKus_0_Name" name="SkuDes[2].SKus[0].Name" class="skuValue" value="重度污渍" />
                            <input type="hidden" id="SkuDes_2_Units_0_Id" name="SkuDes[2].Units[0].Id" class="unitId" value="260" />
                            <input type="hidden" id="SkuDes_2_Units_0_Name" name="SkuDes[2].Units[0].Name" class="unitName" value="平方数" />
                            <div class="xd-xm-title l">单睡衣</div>
                            <div class="xd-numbox l">
                                <div class="xd-jian">-</div>
                                <input class="xd-num skuNum unitNumber" id="SkuDes_2_Units_0_Name" name="SkuDes[2].Units[0].Number" value="0" />
                                <div class="xd-jia">＋</div>
                                <div class="xd-unit">件</div>
                                <div class="clear"></div>
                            </div>
                            <div class="xd-xm-price r mright_r024 skuPrice">
                                预估 ¥0
                            </div>
                            <div class="clear"></div>
                        </div>*#
                    </div>
                </div>
                <div class="xd-box pleft036 mtop_r012">
                    <div class="xd-box-hd ptop036 pbottom036">
                        <div class="xd-hd-title">
                            <i class="xd-icon xdi-bz"></i>
                            <span class="xd-title">如有问题请留言备注<label class="fs_r022 color_898989">（选填）</label></span>
                        </div>
                        <div class="clear"></div>
                    </div>
                    <div class="xd-bzbox">
                        <textarea id="Remarks" name="Remarks" class="xd-textarea"></textarea>
                        <div class="xd-agr">
                            <div class="hmwx-agr">
                                <label>
                                    <input class="hmwx-agr-cb" type="checkbox" name="IsAgree" id="IsAgree" checked="checked" value="true" />
                                    <span class="hmwx-agr-text">我已阅读并同意<a class="hmwx-agr-link" href="/Help/ServiceTerms">《日新洗衣服务条款》</a></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="xd-font">
                    <div id="prePrice" class="xd-font-pre" data-yhqprice="0">享受优惠：¥0</div>
                    <div id="gwcOrderTotalPrice" class="xd-font-total">待付：¥0</div>
                    <div class="xd-font-btn">
                        <input id="btnSave" type="button" value="立即预约" class="hmwx-btn" />
                    </div>
                    <div class="clear"></div>
                </div>
            </div>
        </form>
        <div id="Subpage" class="main" style="display:none;"></div>
        <input hidden id="sysYh" value="0" />
        #parse("/common/share.vm")
        #parse("/common/menu.vm")
    </div>
</div>

<script src="/js/jquery/jquery-1.8.3.min.js" type="text/javascript"></script>
<script src="/js/yujia/font-size.js" type="text/javascript"></script>
<script src="/js/yujia/my.js" type="text/javascript"></script>
<script src="/assets/weiui/weui.js" type="text/javascript"></script>
<script src="//cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<link href="/assets/bootstrap/bootstrap-select.css" rel="stylesheet" />
<script src="/assets/bootstrap/bootstrap-select.js"></script>
<link href="http://libs.baidu.com/bootstrap/3.0.3/css/bootstrap.min.css" rel="stylesheet">
<script src="http://libs.baidu.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
<script type="text/javascript">
    if ('0' == '1') {
        $.my.dialog({
            content: "你已参加   充值活动，不能再次参加 新装保洁 减价优惠",
            buttons: [{
                label: '确认',
                type: 'default',
                onClick: function () {
                    history.back(-1);
                }
            }]
        });
    }

    GetSelectpicker = false;
    if (0!= 0.00) {
        $("#sysYh").val( 0);
        $("#prePrice").html("享受优惠：￥" +  0);
        $("#prePrice").attr("data-yhqprice",  0);
    }

    $(window).on('load', function () {
        $(".selectpicker").selectpicker({
            'noneSelectedText': '请选择员工',
            'noneResultsText': '没有找到员工',
            'maxOptionsText': 2,
            'minOptionsText': 2
        });
        $('.dropdown-menu').css('width', '100%');
        // $('#PROJECT_NAME_SELECT').selectpicker('refresh');//重新刷新不好使
        // $('#PROJECT_NAME_SELECT').selectpicker('render');//也不好使
        //重新绑定监听
        $('.selectpicker').on('show.bs.select', function (e) {
            if (e.target.value) {
                var project = viewModel._helper.projectCodes().filter(function (item) {
                    return item.projectCode === e.target.value;
                });
            }
        });
    });
    //function selectOnchang(e) {
    //    alert(e.value);
    //}
    //清除select
    function Remove_select(){
        $("#id_select").selectpicker('val', '');
        $(".dropdown-menu").find("li").removeClass("selected");
        GetSelectpicker = true;
    }
    $("#select").on('click', function () {
        if (pd() == 1) {
            return false;
        } else {
            if (GetSelectpicker) {
                $("#id_select").html('');
                var $form = $("#form1");
                $.ajax({
                    url: "/Order/GetEmployee",
                    data: $form.serialize(),
                    type: "POST",
                    cache: false,
                    beforeSend: function () {
                        $.weui.loading("正在获取服务员工");
                    },
                    complete: function () {
                        $.weui.hideLoading();
                    },
                    success: function (data) {
                        GetSelectpicker = false;
                        if (data.State == 1) {
                            for (var i = 0; i < data.Data.length; i++) {
                                if (i >= 5) {
                                    $("#id_select").append(" <option hidden data-content=\"<span class=\'label label-warning\'> " + data.Data[i].No + "</span >\" value=\"" + data.Data[i].Id + "\">" + data.Data[i].No + "</option>");
                                } else {
                                    $("#id_select").append(" <option data-content=\"<span class=\'label label-warning\'> " + data.Data[i].No + "</span >\" value=\"" + data.Data[i].Id + "\">" + data.Data[i].No + "</option>");
                                }
                            }

                            $(".selectpicker").selectpicker('refresh');
                        } else {
                            $.my.dialog({
                                content: r.Msg,
                                buttons: [{
                                    label: '确认',
                                    type: 'default',
                                    onClick: function () {
                                        $("#select").removeAttr("disabled");
                                    }
                                }]
                            });
                            return false;
                        }
                    }
                });
            }
        }
    })

    var productSameArea = 'SC001,SC002,0005';
    //所有的单选框赋值
    $("input[type='checkbox']").on("change", function () {
        var ischeck = $(this).is(":checked");
        if (ischeck) {
            $(this).val(true);
        } else {
            $(this).val(false);
        }

    });
    //xd-body显示隐藏控制
    $(".xd-checktog").on("change", function () {

        var ischeck = $(this).is(":checked");
        if (ischeck) {
            $(this).parents(".xd-box").find(".xd-body").show();
        } else {
            $(this).parents(".xd-box").find(".xd-body").hide();
        }

    });
    //数量增减
    $(".xd-jia").live("click", function () {
        var t = this;
        var msg = "";
        var number = $(t).parent(".xd-numbox").find(".xd-num");
        var oldnumber = parseInt(number.val());
        number = parseInt(number.val()) + 1;
        var max = parseInt($(t).parent(".xd-numbox").attr("data-max"));
        var unitName = $(t).parents(".xd-xms").find(".xd-xm-title").html();
        var unit = $(t).parents(".xd-numbox").find(".xd-unit").html();
        if ($(t).parents(".xd-xms").hasClass("skuList")) {
            //多个sku-数量增减
            max = parseInt($(t).parents(".skuList").attr("data-max"));
            var skumax = max;
            var skunum = 0;
            $(t).parents(".skuList").find(".skuNum").each(function () {
                skunum += parseInt($(this).val());
            });
            if (max <= skunum ){
                max = oldnumber;
                // msg = "服务项目总数最多" + skumax + unit;
            }
        }
        if ($(t).parents(".xd-xms").hasClass("skuAndUnit") && number > max) {
            // msg = unitName + "最大值" + max + unit;
        }
        if (msg != "") {
            alert(msg);
            return false;
        }
        if (max != undefined && !isNaN(max) && number > max)
            number = max;
        $(t).parent(".xd-numbox").find(".xd-num").val(number);
        $(t).parent(".xd-numbox").find(".xd-num").attr("data-oldval", number);
        plusAndMinus($(t).parent(".xd-numbox").find(".xd-num"));
        Remove_select();
    });
    $(".xd-jian").live("click", function () {
        var t = this;
        var msg = "";
        var number = $(t).parent(".xd-numbox").find(".xd-num");
        var oldnumber = parseInt(number.val());
        number = parseInt(number.val()) - 1;
        var min = parseInt($(t).parent(".xd-numbox").attr("data-min"));
        if ($(t).parents(".xd-xms").hasClass("skuList")) {
            //多个sku-数量增减
            min = 0;
        }
        if (msg != "") {
            alert(msg);
            return false;
        }
        if (min != undefined && !isNaN(min) && number < min)
            number = min;
        $(t).parent(".xd-numbox").find(".xd-num").val(number);
        $(t).parent(".xd-numbox").find(".xd-num").attr("data-oldval", number);
        plusAndMinus($(t).parent(".xd-numbox").find(".xd-num"));
        Remove_select();
    });
    $(".xd-num").focus(function () {
        $(this).attr("data-oldval", $(this).val());
    });
    //增值服务与单一sku销售属性-输入框（数字最大最小值）
    $(".surBox .xd-num,.unitBox .xd-num").on("change", function () {
        var msg = "";
        var sum = parseInt($(this).val());
        var min = parseInt($(this).parent(".xd-numbox").attr("data-min"));
        var max = parseInt($(this).parent(".xd-numbox").attr("data-max"));
        var unitName = $(this).parents(".xd-xm").find(".xd-xm-title").html();
        var unit = $(this).parents(".xd-numbox").find(".xd-unit").html();
        var oldnum = parseInt($(this).attr("data-oldval"));
        if (isNaN(oldnum)) {
            oldnum = 0;
        }
        $(this).val(sum);
        if (sum < min) {
            $(this).val(min);
        }
        if (sum > max) {
            $(this).val(oldnum);
        }
        if (isNaN(sum)) {
            $(this).val(min);
        }
        if ($(this).parents(".xd-xms").hasClass("skuAndUnit") && sum > max) {
            msg = unitName + "最大值" + max + unit;
        }
        if (msg != "") {
            alert(msg);
            return false;
        }
        plusAndMinus(this);
    });
    //多个sku单一销售属性-输入框（数字最大最小值）
    $(".skuNum").live("change", function () {
        var msg = "";
        $(this).val(parseInt($(this).val()));
        var number = parseInt($(this).val());
        var min =0;
        var max = parseInt($(this).parents(".skuList").attr("data-max"));
        var unit = $(this).parents(".xd-numbox").find(".xd-unit").html();
        var skunum = 0;
        var skumax = max;
        var oldnum = parseInt($(this).attr("data-oldval"));
        if (isNaN(oldnum)) {
            oldnum = 0;
        }
        $(this).parents(".skuList").find(".skuNum").each(function () {
            skunum += parseInt($(this).val());
        });
        if (max < skunum) {
            max = max - (skunum - number);
            if (max<0){
                max = 0;
            }
            // msg = "服务项目总数最多" + skumax + unit;
        }
        if (number < min) {
            $(this).val(min);
        }
        if (number > max) {
            $(this).val(oldnum);
        }
        if (isNaN(number)) {
            $(this).val(min);
        }
        if (msg != "") {
            alert(msg);
            return false;
        }
        plusAndMinus(this);
    });
    //各计算逻辑总合
    function plusAndMinus(thing) {
        // if ($(thing).hasClass("surNum")) {
            totalSur(thing);
        // }
        if ($(thing).parents(".xd-xms").hasClass("skuAndUnit") || $(thing).parents(".xd-xm").hasClass("skuAndUnit")) {
            // getSkuPrice(thing);
        }
    }
    //增值材料价格计算
    function totalSur(thing) {
        var num = parseFloat($(thing).val());
        var price = parseFloat($(thing).parents(".xd-numbox").attr("data-price"));
        var total = num * price;
        $(thing).parents(".skuAndUnit").find(".skuPrice").html("¥" + total);
        $(thing).parents(".skuAndUnit").find(".gwcPrice").val(total);
        orderTotalPrice();
    }
    //选择服务地址
    $(".serviceAddr").on("click", function () {
        var thisSerAddr = this;
        var bindid = $(thisSerAddr).attr("data-idaddr");
        var addrid = $("#" + bindid).val();
        if (addrid == "" || addrid==undefined) {
            addrid = 0;
        }
        var startAddr_areaid = $("#ArearId").val();
        if (bindid =="Addrs1"){
            //判断同区处理
            var productCode = $("#ProductCode").val();
            var sameAreaArray = productSameArea.split(",");
            var isSameArea = false;//判断同区域
            for (var i = 0; i < sameAreaArray.length; i++) {
                if (productCode == sameAreaArray[i]) {
                    isSameArea = true;
                }
            }
            if (!isSameArea) {
                startAddr_areaid = "";
            }
        }
        if (bindid != "Addrs1") {
            startAddr_areaid = "";
        }
        $.ajax({
            url: '/sysUserAddress?addrid=' + addrid + "&areaid=" + startAddr_areaid,
            type: 'get',
            cache: false,
            // async: false,
            beforeSend: function () {
                // $.weui.loading("正在获取服务地址");
            },
            complete: function () {
                // $.weui.hideLoading();
            },
            success: function (html) {
                $("#form1").hide();
                $(".GoBack").attr("href", "javascript:void(0);");
                $("#Subpage").html(html);
                $("#Subpage").show();
                $(".Sub").html("地址选择");
                //$("#html_body").getNiceScroll().resize();
                //选择地址
                $("#Subpage").attr("data-thisSerAddr", "#" + $(thisSerAddr).attr("id"));
                $("#Subpage").attr("data-idaddr", bindid);
                $("#Subpage").attr("data-productSameAre", productSameArea);
                $("#Subpage").attr("data-isSameArea", isSameArea);
                $(".pick").on("click", function () { orderAddress(this, "#" + $(thisSerAddr).attr("id"), bindid, productSameArea, isSameArea); });
                Remove_select();
            }
        });
    })
    //是否返回按钮事件
    $(".GoBack").click(function () {
        var subpage = $("#Subpage").attr("data-subpage");
        if ($("#form1").is(":hidden")) {
            $("#form1").show();
            $("#Subpage").hide();
            $("#Subpage").html("");
            $(".Sub").html($("#ProductName").val());
            $("#Subpage").attr("data-subpage", "");
            //$("#html_body").getNiceScroll().resize();
        } else {
            window.location.href = "javascript:history.back(-1);";
        }
    });

    //选择地址
/*    function orderAddress(thisPick, thisSerAddr, bindid, productSameArea, isSameArea) {
        if (isSameArea == "true" || isSameArea) { isSameArea = true; } else { isSameArea = false; }
        var startAddr_areaid = $("#ArearId").val();
        $(thisPick).parents(".address_list").find("li").removeClass("rad-addorder-st");
        $(thisPick).parents("li").addClass("rad-addorder-st");
        var addrid = $(thisPick).attr("data-addrid");
        var mname = $(thisPick).attr("data-mname");
        var mphone = $(thisPick).attr("data-mphone");
        var addr = $(thisPick).attr("data-addr");
        var area = $(thisPick).attr("data-area");
        var cityid = $(thisPick).attr("data-cityid");
        var areaid = $(thisPick).attr("data-areaid");
        if (bindid == "Addrs1") {
            if (!isSameArea) {
                $("#Addrs1").val(addrid);
                if ($(thisSerAddr).prop("tagName").toLowerCase() == "input") {
                    $(thisSerAddr).val(addr);
                } else {
                    $(thisSerAddr).html(addr);
                }
            }
            if (productSameArea != "" && isSameArea) {
                if (startAddr_areaid == "2" || startAddr_areaid == "3") {
                    if (areaid != "2" && areaid != "3") {
                        $.my.dialog({
                            content: "该产品只服务于同区或岛内搬家！",
                            buttons: [{
                                label: '确认',
                                type: 'default',
                                onClick: function () {
                                }
                            }]
                        });
                    } else {
                        $("#Addrs1").val(addrid);
                        if ($(thisSerAddr).prop("tagName").toLowerCase() == "input") {
                            $(thisSerAddr).val(addr);
                        } else {
                            $(thisSerAddr).html(addr);
                        }
                    }
                } else if (startAddr_areaid != areaid) {
                    $.my.dialog({
                        content: "该产品只服务于同区或岛内搬家！",
                        buttons: [{
                            label: '确认',
                            type: 'default',
                            onClick: function () {
                            }
                        }]
                    });
                } else {
                    $("#Addrs1").val(addrid);
                    if ($(thisSerAddr).prop("tagName").toLowerCase() == "input") {
                        $(thisSerAddr).val(addr);
                    } else {
                        $(thisSerAddr).html(addr);
                    }
                }
            }
        }
        if (bindid == "Addrs0") {
            if ($("#Addrs0").val() != addrid) {
                $("#Addrs1").val("");
                if ($("#serviceAddr1").length > 0){
                    if ($("#serviceAddr1").prop("tagName").toLowerCase() == "input") {
                        $("#serviceAddr1").val("");
                    } else {
                        $("#serviceAddr1").html("请选择终点地址");
                    }
                }
            }
            $("#Addrs0").val(addrid);
            if ($(thisSerAddr).prop("tagName").toLowerCase() == "input") {
                $(thisSerAddr).val(addr);
            } else {
                $(thisSerAddr).html(addr);
            }
            if ($("#Addrs0").val() != "" && $("#StartTime").val() != "" &&($("#CityId").val() != cityid || $("#ArearId").val() != areaid)) {
                setTimeout(function () {
                    var isnum = true;
                    $("#serviceProject").find(".xd-num").each(function () {
                        if (isnum&&parseInt($(this).val()) > 0) {
                            isnum= getSkuPrice(this);
                        }
                        if (!isnum && parseInt($(this).val()) > 0) {
                            var min = parseInt($(this).parent(".xd-numbox").attr("data-min"));
                            if ($(this).parents(".xd-xms").hasClass("skuList") || isNaN(min)) {
                                //多个sku-
                                min = 0;
                            }
                            $(this).parent(".xd-numbox").find(".xd-num").val(min);
                            $(this).parent(".xd-numbox").find(".xd-num").attr("data-oldval", min);
                            $(this).parents(".skuAndUnit").find(".gwcPrice").val(0);
                            if ($(this).parents(".xd-xms").hasClass("skuList")) {
                                $(this).parents(".skuAndUnit").find(".skuPrice").html("¥" + 0);
                            }
                            orderTotalPrice();
                        }
                    });
                }, 0);
            }
            $("#CityId").val(cityid);
            $("#ArearId").val(areaid);
        }
        $("#Subpage").hide();
        $("#form1").show();
        $(".Sub").html($("#ProductName").val());
        //$("#html_body").getNiceScroll().resize();
    }*/

    // 选择服务时间
    $("#DateTimeFixed").click(function () {
        var productId = $("#ProductId").val();
        var arearId = $("#ArearId").val();
        if (arearId=="") {
            alert("请选择服务地址");
            return false;
        }
        $.ajax({
            url: '/time?pid=' + productId + "&areaid=" + arearId + "&presaleMin=" + "2",
            type: 'get',
            cache: false,
            // async: false,
            beforeSend: function () {
                // $.weui.loading("正在获取服务时间");
            },
            complete: function () {
                // $.weui.hideLoading();
            },
            success: function (r) {
                $("#form1").hide();
                $(".GoBack").attr("href", "javascript:void(0);");
                $("#Subpage").html(r);
                $("#Subpage").show();
                $(".Sub").html("选择服务时间");
                //$("#html_body").getNiceScroll().resize();
            }
        });
    });

    //优惠券，优惠价格
    $(".xd-yhq-cb").on("change", function () {
        var prePrice = parseFloat($(this).parents(".xd-yhqbox").attr("data-facevalue"));
        prePrice += parseFloat($("#sysYh").val());
        var thiscb =$(this).is(":checked");
        $(".xd-yhq-cb").not(this).prop('checked', false);
        $(".xd-yhq-cb").not(this).val(false);
        if (thiscb) {
            $(this).val(true);
        } else {
            $(this).val(false);
            prePrice = 0;
        }
        $("#prePrice").html("享受优惠：￥" + prePrice);
        $("#prePrice").attr("data-yhqprice", prePrice);
        orderTotalPrice();
    })

    //获取sku组合的价格
/*    function getSkuPrice(thisgwc) {
        //重置处理//
        var min = parseInt($(thisgwc).parent(".xd-numbox").attr("data-min"));
        if ($(thisgwc).parents(".xd-xms").hasClass("skuList") || isNaN(min)) {
            //多个sku-
            min = 0;
        }
        $(thisgwc).parents(".skuAndUnit").find(".gwcPrice").val(0);
        if ($(thisgwc).parents(".xd-xms").hasClass("skuList")) {
            $(thisgwc).parents(".skuAndUnit").find(".skuPrice").html("¥" + 0);
        }
        orderTotalPrice();
        //重置处理//

        if ($("#StartTime").val() == "" || $("#StartTimeSpan").val() == "" || $("#EndTimeSpan").val() == "") {
            $.my.dialog({
                content: '请选择服务时间',
                buttons: [{
                    label: '确认',
                    type: 'default',
                    onClick: function () {
                    }
                }]
            });
            $(thisgwc).parent(".xd-numbox").find(".xd-num").val(min);
            $(thisgwc).parent(".xd-numbox").find(".xd-num").attr("data-oldval", min);
            return false;
        }
        if ($("#CityId").val() == "") {
            $.my.dialog({
                content: '请选择服务地址',
                buttons: [{
                    label: '确认',
                    type: 'default',
                    onClick: function () {
                    }
                }]
            });
            $(thisgwc).parent(".xd-numbox").find(".xd-num").val(min);
            $(thisgwc).parent(".xd-numbox").find(".xd-num").attr("data-oldval", min);
            return false;
        }
        //sku
        var bl = true;
        var skuValues = "";
        var skuInputs = "";
        var skuArray = new Array();
        //sku
        var skulength=$(thisgwc).parents(".skuAndUnit").find(".skuId").length;
        for (var i = 0; i < skulength; i++) {
            var skuId = $(thisgwc).parents(".skuAndUnit").find(".skuId").eq(i).val();
            var skuVal = $(thisgwc).parents(".skuAndUnit").find(".skuValue").eq(i).val();
            var skuObject = new Object();
            skuObject.Id = skuId;
            skuObject.Name = skuVal;
            skuArray.push(skuObject);
        }
        //单位
        var unitValues = "";
        var unitInputs = "";
        var unitArray = new Array();
        var unitlength = $(thisgwc).parents(".skuAndUnit").find(".unitId").length;
        for (var i = 0; i < unitlength; i++) {
            var unitId = $(thisgwc).parents(".skuAndUnit").find(".unitId").eq(i).val();
            var unitNum = $(thisgwc).parents(".skuAndUnit").find(".unitNumber").eq(i).val();
            var unitName = $(thisgwc).parents(".skuAndUnit").find(".unitName").eq(i).val();
            var unitObject = new Object();
            unitObject.Id = unitId;
            unitObject.Name = unitName;
            unitObject.Number = unitNum;
            unitArray.push(unitObject);
        }
        //获取价格
        var proPrice = 0;
        var skuDesObject = new Object();
        skuDesObject.SKus = skuArray;
        skuDesObject.Units = unitArray;
        $.ajax({
            url: '/Order/GetProPrice',
            data: { ProductId: $("#ProductId").val(), CityId: $("#CityId").val(), ArearId: $("#ArearId").val(), StartTime: $("#StartTime").val(), StartTimeSpan: $("#StartTimeSpan").val(), EndTimeSpan: $("#EndTimeSpan").val(), SkuDes: skuDesObject,Method:0 },
            type: 'post',
            cache: false,
            async: false,
            success: function (r) {
                if (r.State == 1) {
                    $("#sysYh").val(r.Data.SYHQAmount);
                    if (r.Data.SYHQAmount > 0) {
                        proPrice = r.Data.Amount;
                        $("#prePrice").html("享受优惠：￥" + r.Data.SYHQAmount);
                        $("#prePrice").attr("data-yhqprice", r.Data.SYHQAmount);
                    } else {
                        proPrice = r.Data;
                    }

                } else {
                    $.my.dialog({
                        content: r.Msg,
                        buttons: [{
                            label: '确认',
                            type: 'default',
                            onClick: function () {
                            }
                        }]
                    });
                    bl = false;
                }
            }
        });
        if (!bl) {
            $(thisgwc).parent(".xd-numbox").find(".xd-num").val(min);
            $(thisgwc).parent(".xd-numbox").find(".xd-num").attr("data-oldval", min);
            return false;
        }
        //服务为0，价格为0
        if (parseInt($(thisgwc).parent(".xd-numbox").find(".xd-num").val()) <= 0) {
            proPrice=0
        }
        //单个sku组合价
        $(thisgwc).parents(".skuAndUnit").find(".gwcPrice").val(proPrice);
        if ($(thisgwc).parents(".xd-xms").hasClass("skuList")) {
            $(thisgwc).parents(".skuAndUnit").find(".skuPrice").html("¥" + proPrice);
        }
        orderTotalPrice();
        return true;
    }*/

    //计算订单总价
    function orderTotalPrice() {
        //订单总价
        var totalPrice = 0;
        $(".gwcPrice").each(function () {
            var price = parseFloat($(this).val());
            if (isNaN(price)) { price = 0; }
            totalPrice += price;
        });
        //减去优惠价
        var prePrice = parseFloat($("#prePrice").attr("data-yhqprice"));
        if (isNaN(prePrice)) { prePrice = 0; }
        totalPrice = Math.round((totalPrice - prePrice)* 100) / 100;
        if (totalPrice < 0) {
            totalPrice = 0;
        }
        $("#gwcOrderTotalPrice").html("待付：¥" + totalPrice);
    }
    //添加订单 判断
    function pd() {
        if ($("#CityId").val() == "") {
            $.my.dialog({
                content: '请选择服务地址',
                buttons: [{
                    label: '确认',
                    type: 'default',
                    onClick: function () {
                        $("#btnSave").removeAttr("disabled");
                        $("#DisForm").remove();
                    }
                }]
            });
            return 1;
        }
        if ($("#StartTime").val() == "" || $("#StartTimeSpan").val() == "" || $("#EndTimeSpan").val() == "") {
            $.my.dialog({
                content: '请选择服务时间',
                buttons: [{
                    label: '确认',
                    type: 'default',
                    onClick: function () {
                        $("#btnSave").removeAttr("disabled");
                        $("#DisForm").remove();
                    }
                }]
            });
            return 1;
        }

        var msgForm = "";
        //单sku
        if ($(".xd-xms").eq(0).hasClass("skuAndUnit")) {
            $(".xd-xm").each(function () {
                var num = parseInt($(this).find(".xd-num").val());
                var min = parseInt($(this).find(".xd-numbox").attr("data-min"));
                var max = parseInt($(this).find(".xd-numbox").attr("data-max"));
                var unitName = $(this).find(".xd-xm-title").html();
                var unit = $(this).find(".xd-unit").html();
                if (num < min) {
                    msgForm = unitName + "最小值" + min + unit;
                    return false;
                }
                if (num > max) {
                    msgForm = unitName + "最大值" + max + unit;
                    return 1;
                }
            });
        }
        //多sku
        if ($(".xd-xm").eq(0).hasClass("skuAndUnit")) {
            var num = 0;
            var min = parseInt($(".xd-xms").eq(0).attr("data-min"));
            var max = parseInt($(".xd-xms").eq(0).attr("data-max"));
            var unit = $(".xd-xm").eq(0).find(".xd-unit").html();
            $(".xd-xm").each(function () {
                num += parseInt($(this).find(".xd-num").val());
            });
            // if (num < min) {
            //     msgForm = "服务项目总数最小" + min + unit;
            // }
            // if (num > max) {
            //     msgForm = "服务项目总数最大" + max + unit;
            // }
        }
        if (msgForm != "") {
            $.my.dialog({
                content: msgForm,
                buttons: [{
                    label: '确认',
                    type: 'default',
                    onClick: function () {
                        $("#btnSave").removeAttr("disabled");
                        $("#DisForm").remove();
                    }
                }]
            });
            return 1;
        }
        return 2;
    }
    //表单提交
    $("#btnSave").click(function (ev) {
        location.href = "/order"

/*        $("#btnSave").attr("disabled", "disabled");
        $("body").append('<div id="DisForm" style="width:100%;height:100%;position:fixed;z-index:100;top:0;left:0;"></div>');
        if (pd() == 1) {
            return false;
        };
        $('.bootstrap-select').removeClass('open')
        var $form = $("#form1");
        if ($("#id_select").length > 0) {
            $("#ServiceNos").val($("#id_select").selectpicker('val'))
        }
        if ($("#ProductId").val() == '33') {

        }
        $.ajax({
            url: "/order",
            ## data: $form.serialize(),
            type: "POST",
            cache: false,
            //async: false,
            beforeSend: function () {
                $("#btnSave").attr("disabled", "disabled");
            },
            success: function (r) {
                if (r.State == 1) //成功
                {

                    location.href = "/Payment/Pay?billNo=" + r.Data + "&goBack=/Payment/OrderDetails?billNo=" + r.Data;
                } else {
                    $.my.dialog({
                        content: r.Msg,
                        buttons: [{
                            label: '确认',
                            type: 'default',
                            onClick: function () {
                                $("#btnSave").removeAttr("disabled");
                                $("#DisForm").remove();
                            }
                        }]
                    });
                }
            }
        });
        */
        return false;
    });
</script>

</body>
</html>
<script>
    var storage = window.sessionStorage;
    var productInfo = JSON.parse(storage.getItem("productInfo"));
    var html = [], totalPrice = 0;
    $.each(productInfo["washing"], function(i, item) {
        var skuPrice = item.price * item.order;
        totalPrice += skuPrice;
        html.push(
            '<div class="xd-xm pbottom024 skuAndUnit">' +
            '    <input type="hidden" id="id" name="id" class="skuId" value="' + item.id + '" />' +
            '    <input type="hidden" id="washing_name" name="washing_name" class="unitName" value="' + item.washing_name + '" />' +
            '    <input type="hidden" id="category_id" name="category_id" class="skuValue" value="' + item.category_id + '" />' +
            '    <input type="hidden" id="price" name="price" class="unitName" value="' + item.price + '" />' +
            '    <input type="hidden" class="gwcPrice" value="' + totalPrice + '" />' +
            '    <div class="xd-xm-title l">' + item.washing_name + '</div>' +
            '    <div class="xd-numbox l" data-price="' + item.price + '">' +
            '        <div class="xd-jian">-</div>' +
            '            <input class="xd-num skuNum unitNumber" id="order" name="order" value="' + item.order + '" />' +
            '        <div class="xd-jia">＋</div>' +
            '        <div class="xd-unit">件</div>' +
            '        <div class="clear"></div>' +
            '    </div>' +
            '    <div class="xd-xm-price r mright_r024 skuPrice">¥' + totalPrice  + '</div>' +
            '    <div class="clear"></div>' +
            '</div>'
        );
    })
    $("#gwcOrderTotalPrice").html("待付：¥" + totalPrice);
    $("#serviceProject .skuList").html(html.join(""));

    function GetQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return unescape(r[2]); return null;
    }
    if (GetQueryString('PayMethod') != null) {
        var date = new Date();
        date.setTime(date.getTime() + 60 * 60 * 1000);
        $.cookie('PayMethod', GetQueryString('PayMethod'), {
            expires: date
        });
    }
    //else {
    //      $.cookie('PayMethod', '', { expires: -1 }); // 删除 cookie
    //}
</script>